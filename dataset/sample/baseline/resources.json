[
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.Storage/storageAccounts/[parameters('storageAccountName')]",
    "type": "Microsoft.Storage/storageAccounts",
    "apiVersion": "2023-05-01",
    "name": "[parameters('storageAccountName')]",
    "location": "[parameters('location')]",
    "properties": {
      "isHnsEnabled": true,
      "isLocalUserEnabled": true,
      "isSftpEnabled": true
    },
    "dependsOn": [],
    "tags": {},
    "sku": {
      "name": "[parameters('storageAccountType')]"
    },
    "kind": "StorageV2",
    "_raw": {
      "type": "Microsoft.Storage/storageAccounts",
      "apiVersion": "2023-05-01",
      "name": "[parameters('storageAccountName')]",
      "location": "[parameters('location')]",
      "sku": {
        "name": "[parameters('storageAccountType')]"
      },
      "kind": "StorageV2",
      "properties": {
        "isHnsEnabled": true,
        "isLocalUserEnabled": true,
        "isSftpEnabled": true
      }
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-sftp/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.Storage/storageAccounts/blobServices/containers/[format('{0}/default/{1}', parameters('storageAccountName'), parameters('homeDirectory'))]",
    "type": "Microsoft.Storage/storageAccounts/blobServices/containers",
    "apiVersion": "2023-05-01",
    "name": "[format('{0}/default/{1}', parameters('storageAccountName'), parameters('homeDirectory'))]",
    "location": null,
    "properties": {
      "publicAccess": "None"
    },
    "dependsOn": [
      "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
    ],
    "tags": {},
    "sku": null,
    "kind": null,
    "_raw": {
      "type": "Microsoft.Storage/storageAccounts/blobServices/containers",
      "apiVersion": "2023-05-01",
      "name": "[format('{0}/default/{1}', parameters('storageAccountName'), parameters('homeDirectory'))]",
      "properties": {
        "publicAccess": "None"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
      ]
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-sftp/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.Storage/storageAccounts/localUsers/[format('{0}/{1}', parameters('storageAccountName'), parameters('userName'))]",
    "type": "Microsoft.Storage/storageAccounts/localUsers",
    "apiVersion": "2023-05-01",
    "name": "[format('{0}/{1}', parameters('storageAccountName'), parameters('userName'))]",
    "location": null,
    "properties": {
      "permissionScopes": [
        {
          "permissions": "rcwdl",
          "service": "blob",
          "resourceName": "[parameters('homeDirectory')]"
        }
      ],
      "homeDirectory": "[parameters('homeDirectory')]",
      "sshAuthorizedKeys": "[if(empty(parameters('publicKey')), null(), createArray(createObject('description', format('{0} public key', parameters('userName')), 'key', parameters('publicKey'))))]",
      "hasSharedKey": false
    },
    "dependsOn": [
      "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
    ],
    "tags": {},
    "sku": null,
    "kind": null,
    "_raw": {
      "type": "Microsoft.Storage/storageAccounts/localUsers",
      "apiVersion": "2023-05-01",
      "name": "[format('{0}/{1}', parameters('storageAccountName'), parameters('userName'))]",
      "properties": {
        "permissionScopes": [
          {
            "permissions": "rcwdl",
            "service": "blob",
            "resourceName": "[parameters('homeDirectory')]"
          }
        ],
        "homeDirectory": "[parameters('homeDirectory')]",
        "sshAuthorizedKeys": "[if(empty(parameters('publicKey')), null(), createArray(createObject('description', format('{0} public key', parameters('userName')), 'key', parameters('publicKey'))))]",
        "hasSharedKey": false
      },
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
      ]
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-sftp/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.Storage/storageAccounts/[parameters('storageAccountName')]",
    "type": "Microsoft.Storage/storageAccounts",
    "apiVersion": "2023-01-01",
    "name": "[parameters('storageAccountName')]",
    "location": "[parameters('location')]",
    "properties": {
      "accessTier": "Hot"
    },
    "dependsOn": [],
    "tags": {},
    "sku": {
      "name": "Standard_LRS"
    },
    "kind": "StorageV2",
    "_raw": {
      "type": "Microsoft.Storage/storageAccounts",
      "apiVersion": "2023-01-01",
      "name": "[parameters('storageAccountName')]",
      "location": "[parameters('location')]",
      "sku": {
        "name": "Standard_LRS"
      },
      "kind": "StorageV2",
      "properties": {
        "accessTier": "Hot"
      }
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-multi-blob-container/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.Storage/storageAccounts/blobServices/[format('{0}/{1}', parameters('storageAccountName'), 'default')]",
    "type": "Microsoft.Storage/storageAccounts/blobServices",
    "apiVersion": "2023-01-01",
    "name": "[format('{0}/{1}', parameters('storageAccountName'), 'default')]",
    "location": null,
    "properties": {},
    "dependsOn": [
      "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
    ],
    "tags": {},
    "sku": null,
    "kind": null,
    "_raw": {
      "type": "Microsoft.Storage/storageAccounts/blobServices",
      "apiVersion": "2023-01-01",
      "name": "[format('{0}/{1}', parameters('storageAccountName'), 'default')]",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
      ]
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-multi-blob-container/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.Storage/storageAccounts/blobServices/containers/[format('{0}/{1}/{2}', parameters('storageAccountName'), 'default', format('{0}{1}', parameters('containerPrefix'), range(0, parameters('numberOfContainers'))[copyIndex()]))]",
    "type": "Microsoft.Storage/storageAccounts/blobServices/containers",
    "apiVersion": "2023-01-01",
    "name": "[format('{0}/{1}/{2}', parameters('storageAccountName'), 'default', format('{0}{1}', parameters('containerPrefix'), range(0, parameters('numberOfContainers'))[copyIndex()]))]",
    "location": null,
    "properties": {},
    "dependsOn": [
      "[resourceId('Microsoft.Storage/storageAccounts/blobServices', parameters('storageAccountName'), 'default')]"
    ],
    "tags": {},
    "sku": null,
    "kind": null,
    "_raw": {
      "copy": {
        "name": "containers",
        "count": "[length(range(0, parameters('numberOfContainers')))]"
      },
      "type": "Microsoft.Storage/storageAccounts/blobServices/containers",
      "apiVersion": "2023-01-01",
      "name": "[format('{0}/{1}/{2}', parameters('storageAccountName'), 'default', format('{0}{1}', parameters('containerPrefix'), range(0, parameters('numberOfContainers'))[copyIndex()]))]",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts/blobServices', parameters('storageAccountName'), 'default')]"
      ]
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-multi-blob-container/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.Storage/storageAccounts/[parameters('storageAccountName')]",
    "type": "Microsoft.Storage/storageAccounts",
    "apiVersion": "2023-01-01",
    "name": "[parameters('storageAccountName')]",
    "location": "[parameters('location')]",
    "properties": {
      "accessTier": "Hot"
    },
    "dependsOn": [],
    "tags": {},
    "sku": {
      "name": "Standard_LRS"
    },
    "kind": "StorageV2",
    "_raw": {
      "type": "Microsoft.Storage/storageAccounts",
      "apiVersion": "2023-01-01",
      "name": "[parameters('storageAccountName')]",
      "location": "[parameters('location')]",
      "sku": {
        "name": "Standard_LRS"
      },
      "kind": "StorageV2",
      "properties": {
        "accessTier": "Hot"
      }
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-blob-container/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.Storage/storageAccounts/blobServices/[format('{0}/{1}', parameters('storageAccountName'), 'default')]",
    "type": "Microsoft.Storage/storageAccounts/blobServices",
    "apiVersion": "2023-01-01",
    "name": "[format('{0}/{1}', parameters('storageAccountName'), 'default')]",
    "location": null,
    "properties": {},
    "dependsOn": [
      "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
    ],
    "tags": {},
    "sku": null,
    "kind": null,
    "_raw": {
      "type": "Microsoft.Storage/storageAccounts/blobServices",
      "apiVersion": "2023-01-01",
      "name": "[format('{0}/{1}', parameters('storageAccountName'), 'default')]",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
      ]
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-blob-container/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.Storage/storageAccounts/blobServices/containers/[format('{0}/{1}/{2}', parameters('storageAccountName'), 'default', parameters('containerName'))]",
    "type": "Microsoft.Storage/storageAccounts/blobServices/containers",
    "apiVersion": "2023-01-01",
    "name": "[format('{0}/{1}/{2}', parameters('storageAccountName'), 'default', parameters('containerName'))]",
    "location": null,
    "properties": {},
    "dependsOn": [
      "[resourceId('Microsoft.Storage/storageAccounts/blobServices', parameters('storageAccountName'), 'default')]"
    ],
    "tags": {},
    "sku": null,
    "kind": null,
    "_raw": {
      "type": "Microsoft.Storage/storageAccounts/blobServices/containers",
      "apiVersion": "2023-01-01",
      "name": "[format('{0}/{1}/{2}', parameters('storageAccountName'), 'default', parameters('containerName'))]",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts/blobServices', parameters('storageAccountName'), 'default')]"
      ]
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-blob-container/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.Storage/storageAccounts/[parameters('storageAccountName')]",
    "type": "Microsoft.Storage/storageAccounts",
    "apiVersion": "2021-04-01",
    "name": "[parameters('storageAccountName')]",
    "location": "[parameters('location')]",
    "properties": {
      "encryption": {
        "keySource": "Microsoft.Storage",
        "services": {
          "blob": {
            "enabled": "[parameters('blobEncryptionEnabled')]"
          }
        }
      }
    },
    "dependsOn": [],
    "tags": {},
    "sku": {
      "name": "[parameters('storageAccountType')]"
    },
    "kind": "Storage",
    "_raw": {
      "type": "Microsoft.Storage/storageAccounts",
      "apiVersion": "2021-04-01",
      "name": "[parameters('storageAccountName')]",
      "location": "[parameters('location')]",
      "sku": {
        "name": "[parameters('storageAccountType')]"
      },
      "kind": "Storage",
      "properties": {
        "encryption": {
          "keySource": "Microsoft.Storage",
          "services": {
            "blob": {
              "enabled": "[parameters('blobEncryptionEnabled')]"
            }
          }
        }
      }
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-account-service-encryption-create/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.Storage/storageAccounts/[parameters('storageAccountName')]",
    "type": "Microsoft.Storage/storageAccounts",
    "apiVersion": "2022-09-01",
    "name": "[parameters('storageAccountName')]",
    "location": "[parameters('location')]",
    "properties": {},
    "dependsOn": [],
    "tags": {},
    "sku": {
      "name": "[parameters('storageAccountType')]"
    },
    "kind": "StorageV2",
    "_raw": {
      "type": "Microsoft.Storage/storageAccounts",
      "apiVersion": "2022-09-01",
      "name": "[parameters('storageAccountName')]",
      "location": "[parameters('location')]",
      "sku": {
        "name": "[parameters('storageAccountType')]"
      },
      "kind": "StorageV2",
      "properties": {}
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-account-create/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.Storage/storageAccounts/[parameters('storageAccountName')]",
    "type": "Microsoft.Storage/storageAccounts",
    "apiVersion": "2021-06-01",
    "name": "[parameters('storageAccountName')]",
    "location": "[parameters('location')]",
    "properties": {},
    "dependsOn": [],
    "tags": {},
    "sku": {
      "name": "[parameters('storageSku')]"
    },
    "kind": "StorageV2",
    "_raw": {
      "type": "Microsoft.Storage/storageAccounts",
      "apiVersion": "2021-06-01",
      "name": "[parameters('storageAccountName')]",
      "location": "[parameters('location')]",
      "kind": "StorageV2",
      "sku": {
        "name": "[parameters('storageSku')]"
      }
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-static-website/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.ManagedIdentity/userAssignedIdentities/DeploymentScript",
    "type": "Microsoft.ManagedIdentity/userAssignedIdentities",
    "apiVersion": "2018-11-30",
    "name": "DeploymentScript",
    "location": "[parameters('location')]",
    "properties": {},
    "dependsOn": [],
    "tags": {},
    "sku": null,
    "kind": null,
    "_raw": {
      "type": "Microsoft.ManagedIdentity/userAssignedIdentities",
      "apiVersion": "2018-11-30",
      "name": "DeploymentScript",
      "location": "[parameters('location')]"
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-static-website/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.Authorization/roleAssignments/[guid(resourceGroup().id, resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', 'DeploymentScript'), subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '17d1049b-9a84-46fb-8f53-869881c3d3ab'))]",
    "type": "Microsoft.Authorization/roleAssignments",
    "apiVersion": "2020-04-01-preview",
    "name": "[guid(resourceGroup().id, resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', 'DeploymentScript'), subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '17d1049b-9a84-46fb-8f53-869881c3d3ab'))]",
    "location": null,
    "properties": {
      "roleDefinitionId": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '17d1049b-9a84-46fb-8f53-869881c3d3ab')]",
      "principalId": "[reference(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', 'DeploymentScript'), '2018-11-30').principalId]",
      "principalType": "ServicePrincipal"
    },
    "dependsOn": [
      "[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', 'DeploymentScript')]",
      "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
    ],
    "tags": {},
    "sku": null,
    "kind": null,
    "_raw": {
      "type": "Microsoft.Authorization/roleAssignments",
      "apiVersion": "2020-04-01-preview",
      "scope": "[format('Microsoft.Storage/storageAccounts/{0}', parameters('storageAccountName'))]",
      "name": "[guid(resourceGroup().id, resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', 'DeploymentScript'), subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '17d1049b-9a84-46fb-8f53-869881c3d3ab'))]",
      "properties": {
        "roleDefinitionId": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '17d1049b-9a84-46fb-8f53-869881c3d3ab')]",
        "principalId": "[reference(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', 'DeploymentScript'), '2018-11-30').principalId]",
        "principalType": "ServicePrincipal"
      },
      "dependsOn": [
        "[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', 'DeploymentScript')]",
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
      ]
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-static-website/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.Resources/deploymentScripts/deploymentScript",
    "type": "Microsoft.Resources/deploymentScripts",
    "apiVersion": "2020-10-01",
    "name": "deploymentScript",
    "location": "[parameters('location')]",
    "properties": {
      "azPowerShellVersion": "3.0",
      "scriptContent": "[variables('$fxv#0')]",
      "retentionInterval": "PT4H",
      "environmentVariables": [
        {
          "name": "ResourceGroupName",
          "value": "[resourceGroup().name]"
        },
        {
          "name": "StorageAccountName",
          "value": "[parameters('storageAccountName')]"
        },
        {
          "name": "IndexDocumentPath",
          "value": "[parameters('indexDocumentPath')]"
        },
        {
          "name": "IndexDocumentContents",
          "value": "[parameters('indexDocumentContents')]"
        },
        {
          "name": "ErrorDocument404Path",
          "value": "[parameters('errorDocument404Path')]"
        },
        {
          "name": "ErrorDocument404Contents",
          "value": "[parameters('errorDocument404Contents')]"
        }
      ]
    },
    "dependsOn": [
      "[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', 'DeploymentScript')]",
      "[extensionResourceId(resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName')), 'Microsoft.Authorization/roleAssignments', guid(resourceGroup().id, resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', 'DeploymentScript'), subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '17d1049b-9a84-46fb-8f53-869881c3d3ab')))]",
      "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
    ],
    "tags": {},
    "sku": null,
    "kind": "AzurePowerShell",
    "_raw": {
      "type": "Microsoft.Resources/deploymentScripts",
      "apiVersion": "2020-10-01",
      "name": "deploymentScript",
      "location": "[parameters('location')]",
      "kind": "AzurePowerShell",
      "identity": {
        "type": "UserAssigned",
        "userAssignedIdentities": {
          "[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', 'DeploymentScript'))]": {}
        }
      },
      "properties": {
        "azPowerShellVersion": "3.0",
        "scriptContent": "[variables('$fxv#0')]",
        "retentionInterval": "PT4H",
        "environmentVariables": [
          {
            "name": "ResourceGroupName",
            "value": "[resourceGroup().name]"
          },
          {
            "name": "StorageAccountName",
            "value": "[parameters('storageAccountName')]"
          },
          {
            "name": "IndexDocumentPath",
            "value": "[parameters('indexDocumentPath')]"
          },
          {
            "name": "IndexDocumentContents",
            "value": "[parameters('indexDocumentContents')]"
          },
          {
            "name": "ErrorDocument404Path",
            "value": "[parameters('errorDocument404Path')]"
          },
          {
            "name": "ErrorDocument404Contents",
            "value": "[parameters('errorDocument404Contents')]"
          }
        ]
      },
      "dependsOn": [
        "[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', 'DeploymentScript')]",
        "[extensionResourceId(resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName')), 'Microsoft.Authorization/roleAssignments', guid(resourceGroup().id, resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', 'DeploymentScript'), subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '17d1049b-9a84-46fb-8f53-869881c3d3ab')))]",
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
      ]
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-static-website/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.Storage/storageAccounts/[parameters('storageAccountName')]",
    "type": "Microsoft.Storage/storageAccounts",
    "apiVersion": "2021-04-01",
    "name": "[parameters('storageAccountName')]",
    "location": "[parameters('location')]",
    "properties": {},
    "dependsOn": [],
    "tags": {},
    "sku": {
      "name": "[parameters('storageAccountReplication')]"
    },
    "kind": "StorageV2",
    "_raw": {
      "type": "Microsoft.Storage/storageAccounts",
      "apiVersion": "2021-04-01",
      "name": "[parameters('storageAccountName')]",
      "location": "[parameters('location')]",
      "sku": {
        "name": "[parameters('storageAccountReplication')]"
      },
      "kind": "StorageV2",
      "properties": {}
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-advanced-threat-protection-create/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.Security/advancedThreatProtectionSettings/current",
    "type": "Microsoft.Security/advancedThreatProtectionSettings",
    "apiVersion": "2019-01-01",
    "name": "current",
    "location": null,
    "properties": {
      "isEnabled": true
    },
    "dependsOn": [
      "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
    ],
    "tags": {},
    "sku": null,
    "kind": null,
    "_raw": {
      "condition": "[parameters('advancedThreatProtectionEnabled')]",
      "type": "Microsoft.Security/advancedThreatProtectionSettings",
      "apiVersion": "2019-01-01",
      "scope": "[format('Microsoft.Storage/storageAccounts/{0}', parameters('storageAccountName'))]",
      "name": "current",
      "properties": {
        "isEnabled": true
      },
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
      ]
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-advanced-threat-protection-create/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.Storage/storageAccounts/[parameters('storageAccountName')]",
    "type": "Microsoft.Storage/storageAccounts",
    "apiVersion": "2021-04-01",
    "name": "[parameters('storageAccountName')]",
    "location": "[parameters('location')]",
    "properties": {
      "accessTier": "Hot"
    },
    "dependsOn": [],
    "tags": {},
    "sku": {
      "name": "Standard_LRS"
    },
    "kind": "StorageV2",
    "_raw": {
      "type": "Microsoft.Storage/storageAccounts",
      "apiVersion": "2021-04-01",
      "name": "[parameters('storageAccountName')]",
      "location": "[parameters('location')]",
      "kind": "StorageV2",
      "sku": {
        "name": "Standard_LRS"
      },
      "properties": {
        "accessTier": "Hot"
      }
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-multi-file-share/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.Storage/storageAccounts/fileServices/shares/[format('{0}/default/{1}{2}', parameters('storageAccountName'), parameters('sharePrefix'), range(0, parameters('shareCopy'))[copyIndex()])]",
    "type": "Microsoft.Storage/storageAccounts/fileServices/shares",
    "apiVersion": "2021-04-01",
    "name": "[format('{0}/default/{1}{2}', parameters('storageAccountName'), parameters('sharePrefix'), range(0, parameters('shareCopy'))[copyIndex()])]",
    "location": null,
    "properties": {},
    "dependsOn": [
      "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
    ],
    "tags": {},
    "sku": null,
    "kind": null,
    "_raw": {
      "copy": {
        "name": "fileShares",
        "count": "[length(range(0, parameters('shareCopy')))]"
      },
      "type": "Microsoft.Storage/storageAccounts/fileServices/shares",
      "apiVersion": "2021-04-01",
      "name": "[format('{0}/default/{1}{2}', parameters('storageAccountName'), parameters('sharePrefix'), range(0, parameters('shareCopy'))[copyIndex()])]",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
      ]
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-multi-file-share/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.Storage/storageAccounts/[parameters('storageAccountName')]",
    "type": "Microsoft.Storage/storageAccounts",
    "apiVersion": "2021-04-01",
    "name": "[parameters('storageAccountName')]",
    "location": "[parameters('location')]",
    "properties": {
      "accessTier": "Hot"
    },
    "dependsOn": [],
    "tags": {},
    "sku": {
      "name": "Standard_LRS"
    },
    "kind": "StorageV2",
    "_raw": {
      "type": "Microsoft.Storage/storageAccounts",
      "apiVersion": "2021-04-01",
      "name": "[parameters('storageAccountName')]",
      "location": "[parameters('location')]",
      "kind": "StorageV2",
      "sku": {
        "name": "Standard_LRS"
      },
      "properties": {
        "accessTier": "Hot"
      }
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-file-share/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.Storage/storageAccounts/fileServices/shares/[format('{0}/default/{1}', parameters('storageAccountName'), parameters('fileShareName'))]",
    "type": "Microsoft.Storage/storageAccounts/fileServices/shares",
    "apiVersion": "2021-04-01",
    "name": "[format('{0}/default/{1}', parameters('storageAccountName'), parameters('fileShareName'))]",
    "location": null,
    "properties": {},
    "dependsOn": [
      "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
    ],
    "tags": {},
    "sku": null,
    "kind": null,
    "_raw": {
      "type": "Microsoft.Storage/storageAccounts/fileServices/shares",
      "apiVersion": "2021-04-01",
      "name": "[format('{0}/default/{1}', parameters('storageAccountName'), parameters('fileShareName'))]",
      "dependsOn": [
        "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
      ]
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-file-share/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.KeyVault/vaults/[parameters('keyVaultName')]",
    "type": "Microsoft.KeyVault/vaults",
    "apiVersion": "2021-10-01",
    "name": "[parameters('keyVaultName')]",
    "location": "[parameters('location')]",
    "properties": {
      "sku": {
        "name": "standard",
        "family": "A"
      },
      "enableSoftDelete": true,
      "enablePurgeProtection": true,
      "enabledForDiskEncryption": true,
      "tenantId": "[parameters('tenantId')]",
      "accessPolicies": [
        {
          "tenantId": "[parameters('tenantId')]",
          "permissions": {
            "keys": [
              "unwrapKey",
              "wrapKey",
              "get"
            ]
          },
          "objectId": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('userAssignedIdentityResourceGroupName')), 'Microsoft.ManagedIdentity/userAssignedIdentities', parameters('userAssignedIdentityName')), '2018-11-30').principalId]"
        }
      ]
    },
    "dependsOn": [],
    "tags": {},
    "sku": null,
    "kind": null,
    "_raw": {
      "type": "Microsoft.KeyVault/vaults",
      "apiVersion": "2021-10-01",
      "name": "[parameters('keyVaultName')]",
      "location": "[parameters('location')]",
      "properties": {
        "sku": {
          "name": "standard",
          "family": "A"
        },
        "enableSoftDelete": true,
        "enablePurgeProtection": true,
        "enabledForDiskEncryption": true,
        "tenantId": "[parameters('tenantId')]",
        "accessPolicies": [
          {
            "tenantId": "[parameters('tenantId')]",
            "permissions": {
              "keys": [
                "unwrapKey",
                "wrapKey",
                "get"
              ]
            },
            "objectId": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('userAssignedIdentityResourceGroupName')), 'Microsoft.ManagedIdentity/userAssignedIdentities', parameters('userAssignedIdentityName')), '2018-11-30').principalId]"
          }
        ]
      }
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-blob-encryption-with-cmk/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.KeyVault/vaults/keys/[format('{0}/{1}', parameters('keyVaultName'), parameters('keyVaultKeyName'))]",
    "type": "Microsoft.KeyVault/vaults/keys",
    "apiVersion": "2021-10-01",
    "name": "[format('{0}/{1}', parameters('keyVaultName'), parameters('keyVaultKeyName'))]",
    "location": null,
    "properties": {
      "attributes": {
        "enabled": true,
        "exp": "[parameters('keyExpiration')]"
      },
      "keySize": 4096,
      "kty": "RSA"
    },
    "dependsOn": [
      "[resourceId('Microsoft.KeyVault/vaults', parameters('keyVaultName'))]"
    ],
    "tags": {},
    "sku": null,
    "kind": null,
    "_raw": {
      "type": "Microsoft.KeyVault/vaults/keys",
      "apiVersion": "2021-10-01",
      "name": "[format('{0}/{1}', parameters('keyVaultName'), parameters('keyVaultKeyName'))]",
      "properties": {
        "attributes": {
          "enabled": true,
          "exp": "[parameters('keyExpiration')]"
        },
        "keySize": 4096,
        "kty": "RSA"
      },
      "dependsOn": [
        "[resourceId('Microsoft.KeyVault/vaults', parameters('keyVaultName'))]"
      ]
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-blob-encryption-with-cmk/main.bicep",
      "is_mutated": false
    }
  },
  {
    "id": "/subscriptions/template-sim/resourceGroups/template-rg/providers/Microsoft.Storage/storageAccounts/[parameters('storageAccountName')]",
    "type": "Microsoft.Storage/storageAccounts",
    "apiVersion": "2021-04-01",
    "name": "[parameters('storageAccountName')]",
    "location": "[parameters('location')]",
    "properties": {
      "accessTier": "Hot",
      "supportsHttpsTrafficOnly": true,
      "minimumTlsVersion": "TLS1_2",
      "encryption": {
        "identity": {
          "userAssignedIdentity": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('userAssignedIdentityResourceGroupName')), 'Microsoft.ManagedIdentity/userAssignedIdentities', parameters('userAssignedIdentityName'))]"
        },
        "services": {
          "blob": {
            "enabled": true
          }
        },
        "keySource": "Microsoft.Keyvault",
        "keyvaultproperties": {
          "keyname": "[parameters('keyVaultKeyName')]",
          "keyvaulturi": "[if(endsWith(reference(resourceId('Microsoft.KeyVault/vaults', parameters('keyVaultName')), '2021-10-01').vaultUri, '/'), substring(reference(resourceId('Microsoft.KeyVault/vaults', parameters('keyVaultName')), '2021-10-01').vaultUri, 0, sub(length(reference(resourceId('Microsoft.KeyVault/vaults', parameters('keyVaultName')), '2021-10-01').vaultUri), 1)), reference(resourceId('Microsoft.KeyVault/vaults', parameters('keyVaultName')), '2021-10-01').vaultUri)]"
        }
      }
    },
    "dependsOn": [
      "[resourceId('Microsoft.KeyVault/vaults', parameters('keyVaultName'))]",
      "[resourceId('Microsoft.KeyVault/vaults/keys', parameters('keyVaultName'), parameters('keyVaultKeyName'))]"
    ],
    "tags": {},
    "sku": {
      "name": "Standard_LRS"
    },
    "kind": "StorageV2",
    "_raw": {
      "type": "Microsoft.Storage/storageAccounts",
      "apiVersion": "2021-04-01",
      "name": "[parameters('storageAccountName')]",
      "location": "[parameters('location')]",
      "sku": {
        "name": "Standard_LRS"
      },
      "kind": "StorageV2",
      "identity": {
        "type": "UserAssigned",
        "userAssignedIdentities": {
          "[format('{0}', extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('userAssignedIdentityResourceGroupName')), 'Microsoft.ManagedIdentity/userAssignedIdentities', parameters('userAssignedIdentityName')))]": {}
        }
      },
      "properties": {
        "accessTier": "Hot",
        "supportsHttpsTrafficOnly": true,
        "minimumTlsVersion": "TLS1_2",
        "encryption": {
          "identity": {
            "userAssignedIdentity": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('userAssignedIdentityResourceGroupName')), 'Microsoft.ManagedIdentity/userAssignedIdentities', parameters('userAssignedIdentityName'))]"
          },
          "services": {
            "blob": {
              "enabled": true
            }
          },
          "keySource": "Microsoft.Keyvault",
          "keyvaultproperties": {
            "keyname": "[parameters('keyVaultKeyName')]",
            "keyvaulturi": "[if(endsWith(reference(resourceId('Microsoft.KeyVault/vaults', parameters('keyVaultName')), '2021-10-01').vaultUri, '/'), substring(reference(resourceId('Microsoft.KeyVault/vaults', parameters('keyVaultName')), '2021-10-01').vaultUri, 0, sub(length(reference(resourceId('Microsoft.KeyVault/vaults', parameters('keyVaultName')), '2021-10-01').vaultUri), 1)), reference(resourceId('Microsoft.KeyVault/vaults', parameters('keyVaultName')), '2021-10-01').vaultUri)]"
          }
        }
      },
      "dependsOn": [
        "[resourceId('Microsoft.KeyVault/vaults', parameters('keyVaultName'))]",
        "[resourceId('Microsoft.KeyVault/vaults/keys', parameters('keyVaultName'), parameters('keyVaultKeyName'))]"
      ]
    },
    "_metadata": {
      "source_template": "templates/azure-quickstart-templates/quickstarts/microsoft.storage/storage-blob-encryption-with-cmk/main.bicep",
      "is_mutated": false
    }
  }
]