# Maximum Dataset

This is the largest dataset generated by CRUX (Cloud Resource mUtation eXtractor) from the Azure Quickstart Templates collection.

## Dataset Statistics

- **Templates processed**: 1,518 (792 Bicep + 726 ARM JSON)
- **Resources with labels**: 5,019
- **Total rows in CSV**: 12,580
- **Total label assignments**: 27,382
- **Unique label types**: 111
- **Feature columns**: 100

## Files

- `data.csv` - ML-ready dataset with features and binary labels
- `README.md` - This file

## CSV Schema

| Column | Description |
|--------|-------------|
| `resource_id` | Unique Azure resource identifier |
| `resource_type` | Azure resource type (e.g., Microsoft.Storage/storageAccounts) |
| `is_mutated` | Whether this resource was mutated (always 1 in this dataset) |
| `mutation_id` | ID of the mutation applied |
| `mutation_severity` | Severity level (high, medium, low) |
| `has_misconfiguration` | Binary target: 1 if any misconfiguration detected |
| `label_count` | Number of misconfiguration labels |
| `labels` | Comma-separated list of misconfiguration labels |
| `source_template` | Path to source template |
| `feature_*` | 100 numerical feature columns |

## Usage

### Python (pandas + sklearn)

```python
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import classification_report

# Load dataset
df = pd.read_csv('data.csv')

# Extract features and target
feature_cols = [c for c in df.columns if c.startswith('feature_')]
X = df[feature_cols].values
y = df['has_misconfiguration'].values

# Train/test split
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# Train logistic regression
model = LogisticRegression(max_iter=1000)
model.fit(X_train, y_train)

# Evaluate
y_pred = model.predict(X_test)
print(classification_report(y_test, y_pred))
```

### R

```r
library(caret)

# Load dataset
df <- read.csv('data.csv')

# Extract features
feature_cols <- grep('^feature_', names(df), value=TRUE)
X <- df[, feature_cols]
y <- as.factor(df$has_misconfiguration)

# Train/test split
set.seed(42)
train_idx <- createDataPartition(y, p=0.8, list=FALSE)
X_train <- X[train_idx, ]
X_test <- X[-train_idx, ]
y_train <- y[train_idx]
y_test <- y[-train_idx]

# Train logistic regression
model <- train(X_train, y_train, method='glm', family='binomial')

# Evaluate
predictions <- predict(model, X_test)
confusionMatrix(predictions, y_test)
```

## Reproduce This Dataset

To regenerate this dataset locally:

```bash
# 1. Clone the repository
git clone https://github.com/floatingsidewal/CRUX.git
cd CRUX

# 2. Install CRUX
pip install -e .[ml]

# 3. Fetch Azure Quickstart Templates
crux fetch-templates --output templates/

# 4. Generate the dataset
crux generate-dataset \
  --templates templates/azure-quickstart-templates \
  --pattern "**/*.bicep" \
  --include-arm-json \
  --rules rules/ \
  --output dataset/ \
  --name maximum-001

# 5. Export to CSV
crux export-csv \
  --dataset dataset/maximum-001 \
  --output dataset/maximum-001/data.csv \
  --max-features 100 \
  --binary-mode any
```

## Generation Details

- **Generated**: 2025-12-12
- **CRUX version**: 2.0
- **Mutations**: 88 (across 8 resource types)
- **Rules**: 96 (CIS Benchmark aligned)
- **Binary mode**: `any` (positive if ANY misconfiguration detected)

## Label Categories

Labels are derived from CIS Azure Benchmark and custom security rules:

- **Storage**: Public access, weak TLS, insecure transfer, no encryption
- **Key Vault**: No purge protection, soft delete disabled, permissive access
- **VM**: Missing encryption, password auth enabled, no diagnostics
- **Network**: No NSG, public IPs without DDoS, insecure rules
- **App Service**: HTTP allowed, weak TLS, no authentication
- **Container Registry**: Admin enabled, public network access
- **Database**: Public access, no encryption, audit logging disabled
- **Load Balancer**: No health probes, insecure rules
